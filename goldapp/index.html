<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NTGold | Market Price | Manage Portofolio</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
	<link href="./res/css/main.css" rel="stylesheet">
</head>

<body>
	<div id="ptr-spinner">
		<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
			<path d="M21 12a9 9 0 11-6.219-8.56" />
		</svg>
	</div>

    <nav class="desktop-nav">
        <div style="display: flex; align-items: center; gap: 8px;">
			<div class="logo" onclick="nav('market')">NTGold</div>
			<span id="desktop-sub-badge" class="sub-badge"></span>
		</div>
        <div class="nav-links" id="desktop-links"></div>
    </nav>

    <header class="mobile-header">
        <div style="display: flex; align-items: center; gap: 6px;">
			<h1 class="mobile-title" onclick="nav('market')">NTGold</h1>
			<span id="mobile-sub-badge" class="sub-badge"></span>
		</div>
        <div id="mobile-avatar-container" style="display:none">
            <img id="mobile-avatar-img" class="user-avatar" src="" alt="Profile" onclick="nav('profile')">
        </div>
    </header>

    <div class="container">
        
		<!-- Page Market -->
        <div id="page-market" class="active-section section">
			<h2 data-i18n="today_market" style="margin-top:0; font-size:16px; color:var(--text-sub); margin-bottom:15px">Today's Market</h2>

			<div id="market-summary-container" style="margin-bottom: 30px; display: none;">
				<div id="summary-cards-list" style="display: flex; gap: 12px; overflow-x: auto; padding-bottom: 15px; scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch;"></div>
			</div>
            
            <div class="desktop-table-container">
                <table>
                    <thead><tr><th data-i18n="brand">Brand</th><th data-i18n="weight">Weight</th><th data-i18n="price" style="text-align:right">Price</th><th data-i18n="buyback" style="text-align:right">Buyback</th><th data-i18n="updated" style="text-align:right">Updated</th></tr></thead>
                    <tbody id="desktop-tbody"><tr><td colspan="5" style="text-align:center; padding:40px">Loading...</td></tr></tbody>
                </table>
            </div>

            <div class="mobile-list-container" id="mobile-list"></div>
        </div>

		<!-- Page Portfolio -->
		<div id="page-portfolio" class="section">
			<div style="background:linear-gradient(135deg, #F5C518 0%, #D4A017 100%); padding:25px; border-radius:20px; color:black; margin-bottom:25px; position:relative;">
				<div style="display: flex; justify-content: space-between; align-items: center;">
					<div style="font-size:11px; font-weight:700; opacity:0.7; letter-spacing:1px; text-transform:uppercase" data-i18n="net_worth">Total Net Worth</div>
					<button class="hide-toggle" onclick="toggleAmountVisibility()">
						<span class="eye-icon-all">
							<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:18px; color:#000;"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
						</span>
					</button>
				</div>
				<div style="font-size:32px; font-weight:800; margin:5px 0" id="goal-grand-total">Rp 0</div>
				<div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px; border-top: 1px solid rgba(0,0,0,0.1); padding-top: 10px;">
					<div id="goal-grand-grams" style="font-size:13px; font-weight:600; opacity:0.8">0.00 Grams</div>
					<div id="goal-grand-pl" style="font-size:12px; font-weight:800; padding:4px 10px; border-radius:8px; background: rgba(0,0,0,0.05);">+Rp 0 (0%)</div>
				</div>
			</div>
			
			<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
				<!-- <h2 style="margin:0; font-size:20px;" data-i18n="portfolio">Portfolio</h2> -->
				 <span style="margin:0; font-size:10px; font-weight:700; opacity:0.6" data-i18n="buyback">Buyback</span>
				<label class="switch">
					<input type="checkbox" id="goal-buyback-toggle" onchange="fetchGoals()">
					<span class="slider"></span>
				</label>
				<button class="btn-primary" style="margin-left:25px; padding:8px 16px; font-size:12px;" onclick="toggleGoalModal()" data-i18n="setnewgoal">+ New Goal</button>
			</div>
			<div id="goal-list-container" class="mobile-list-container">
			</div>
		</div>

		<div id="goal-modal" class="modal-overlay">
			<div class="modal-content">
				<h3 data-i18n="add_new_goal">Add New Goal</h3>
				<label class="input-label" data-i18n="goal_name">Goal Name</label>
				<input type="text" id="goal-name" placeholder="e.g. Rumah Baru">
				<label class="input-label" data-i18n="goal_target">Target Amount (Rp)</label>
				<input type="tel" id="goal-target" placeholder="e.g. 500.000.000" oninput="formatRupiahInput(this)">
				<div style="display:flex; gap:10px; margin-top:20px">
					<div id="modal-delete-container" style="margin:5px; display: flex;  justify-content: center;  align-items: center; "></div>
					<button class="btn-primary" style="background:#333; color:#fff" onclick="toggleGoalModal()" data-i18n="cancel">Cancel</button>
					<button id="goal-modal-submit-btn" class="btn-primary" onclick="saveGoal()" data-i18n="save">Save</button>
				</div>
			</div>
		</div>

		<!-- Page Wallet Details -->
		<div id="page-wallet-detail" class="section">
			<button onclick="nav('portfolio')" style="background:none; border:none; color:var(--accent); margin-bottom:15px; display:flex; align-items:center; gap:5px; font-weight:700; cursor:pointer;">
				← Back to Goals
			</button>

			<div style="background:linear-gradient(135deg, #F5C518 0%, #D4A017 100%); padding:25px; border-radius:20px; color:black; margin-bottom:20px; position:relative;">
				<div style="display: flex; justify-content: space-between; align-items: center;">
					<div id="wallet-name-display" style="font-size:11px; font-weight:700; opacity:0.7; letter-spacing:1px; text-transform:uppercase">WALLET</div>
					<div style="display: flex; gap: 10px;">
						<button class="hide-toggle" onclick="openEditGoalModal()" style="background: rgba(0,0,0,0.1);">
							<svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
						</button>
						<button class="hide-toggle" onclick="toggleAmountVisibility()">
							<span id="eye-icon">
								<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
							</span>
						</button>
					</div>
				</div>
				
				<div style="font-size:32px; font-weight:800; margin:5px 0" id="pf-total">Rp 0</div>

				<div style="margin: 10px 0;">
					<div style="display:flex; justify-content:space-between; font-size:10px; font-weight:700; margin-bottom:4px; opacity:0.8;">
						<span id="progress-percent">0%</span>
						<span id="progress-target">Target: Rp 0</span>
					</div>
					<div style="height:6px; background:rgba(0,0,0,0.1); border-radius:3px; overflow:hidden;">
						<div id="progress-bar-fill" style="height:100%; background:#000; width:0%; transition: width 0.5s ease;"></div>
					</div>
				</div>

				<div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px; border-top: 1px solid rgba(0,0,0,0.1); padding-top: 10px;">
					<div id="pf-grams" style="font-size:13px; font-weight:600">0.00 Gram</div>
					<div id="pf-pl" style="font-size:12px; font-weight:800; padding:4px 10px; border-radius:8px;">+Rp 0 (0%)</div>
				</div>
			</div>
			
			<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; gap: 10px; padding: 0 5px;">
				<div style="display: flex; align-items: center; gap: 8px;">
					<svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="var(--text-sub)" stroke-width="2.5"><path d="M3 6h18M6 12h12m-9 6h6"/></svg>
					<select id="portfolio-sort" onchange="fetchPortfolio(currentSessionUser)" 
						style="background: transparent; border: none; color: var(--text-sub); font-size: 11px; font-weight: 700; text-transform: uppercase; outline: none; cursor: pointer;">
						<option data-i18n="date_newest" value="pdate-desc" selected>Date (Newest)</option>
						<option data-i18n="date_oldest" value="pdate-asc">Date (Oldest)</option>
						<option data-i18n="weight_high" value="weight-desc">Weight (High)</option>
						<option data-i18n="weight_low" value="weight-asc">Weight (Low)</option>
						<option value="brand-asc">Brand (A-Z)</option>
						<option value="brand-desc">Brand (Z-A)</option>
					</select>
				</div>

				<div style="display: flex; align-items: center; gap: 8px;">
					<span data-i18n="buyback" style="font-size: 11px; font-weight: 700; color: var(--text-sub); text-transform: uppercase; letter-spacing: 0.5px;">Buyback</span>
					<label class="switch">
						<input type="checkbox" id="buyback-toggle" onchange="fetchPortfolio(currentSessionUser)">
						<span class="slider"></span>
					</label>
				</div>
			</div>
			
			<!-- Desktop Wallet List-->
			<div class="wallet-desktop-view">
				<div class="desktop-table-container">
					<table>
						<thead>
							<tr>
								<th data-i18n="brand">Brand</th>
								<th data-i18n="purchase_date">Purchase Date</th>
								<th data-i18n="weight" style="text-align:right">Weight</th>
								<th data-i18n="cost" style="text-align:right">Buy Price</th>
								<th data-i18n="market_value" style="text-align:right">Market Value</th>
								<th data-i18n="pl" style="text-align:right">Profit/Loss</th>
							</tr>
						</thead>
						<tbody id="portfolio-desktop-tbody"></tbody>
					</table>
				</div>
			</div>
            
			<!-- Mobile Wallet List -->
            <div id="portfolio-list" class="mobile-list-container">
                <div style="text-align:center; padding:60px 20px; border:2px dashed var(--border); border-radius:16px; color:var(--text-sub);">
                    <div style="font-size:40px; margin-bottom:10px">✨</div>
                    <p>Loading your vault...</p>
                </div>
            </div>

			<div class="fab-add" onclick="toggleAddModal()">+</div>
		</div>

		<!-- Profile -->
        <div id="page-profile" class="section">
            <div style="text-align:center; margin-bottom:20px">
                <img id="profile-page-img" class="user-avatar" style="width:80px; height:80px; margin:0 auto 10px auto; display:block" src="">
                <h2 style="margin:0; font-size:20px" id="profile-page-name">User</h2>
            </div>
            
            <div class="profile-card">
                <label data-i18n="email_address" class="input-label">Email Address</label>
                <input type="text" id="prof-email" disabled style="opacity:0.5">
                <label data-i18n="full_name" class="input-label">Full Name</label>
                <input type="text" id="prof-name" placeholder="Enter your name">
				<label data-i18n="lang_pref" class="input-label">Language Preference</label>
                <select id="lang_select">
                    <option value="en">English (US)</option>
                    <option value="id">Bahasa Indonesia</option>
                </select>
                <button data-i18n="update_profile_btn" class="btn-primary" onclick="updateName()">Save Changes</button>
            </div>
            <div class="profile-card">
                <label data-i18n="change_pass" class="input-label">Change Password</label>
                <input type="password" id="prof-pass" placeholder="New password">
                <button data-i18n="change_pass_btn" class="btn-primary" style="background:#222; color:#fff; border:1px solid #333" onclick="updatePassword()">Update Password</button>
            </div>
            <button data-i18n="logout" class="btn-primary" style="background:rgba(255,77,77,0.1); color:var(--danger); margin-top:10px" onclick="handleLogout()">Sign Out</button>
        </div>

		<!-- Login and Register -->
        <div id="page-auth" class="section">
            <div style="max-width:400px; margin:40px auto; text-align:center">
                <h1 style="color:var(--accent); margin-bottom:40px">NTGold</h1>
                <div id="login-box">
                    <input type="email" id="l-email" placeholder="Email">
                    <input type="password" id="l-password" placeholder="Password">
                    <button class="btn-primary" onclick="handleLogin()">Sign In</button>
                    <p style="margin-top:20px; font-size:13px; color:var(--text-sub)">New here? <span style="color:var(--accent); cursor:pointer" onclick="toggleAuth()">Create Account</span></p>
                    <p id="l-error" style="color:var(--danger); font-size:12px; display:none"></p>
                </div>

                <div id="register-box" style="display:none">
                    <input type="text" id="r-name" placeholder="Full Name">
                    <input type="email" id="r-email" placeholder="Email">
                    <input type="password" id="r-password" placeholder="Password">
                    <button class="btn-primary" onclick="handleRegister()">Create Account</button>
                    <p style="margin-top:20px; font-size:13px; color:var(--text-sub)">Have an account? <span style="color:var(--accent); cursor:pointer" onclick="toggleAuth()">Log In</span></p>
                    <p id="r-error" style="color:var(--danger); font-size:12px; display:none"></p>
                </div>
            </div>
        </div>
    </div>

	<!-- Modal Add Wallet -->
	<div id="add-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 data-i18n="add_item" style="margin-top:0">Add New Item</h3>
            <label class="input-label" data-i18n="brand">Brand</label>
            <select id="add-brand" onchange="updateWeightOptions(this.value)"></select>
            
            <label class="input-label" data-i18n="weight">Weight (Grams)</label>
            <select id="add-weight"></select>
            
            <label class="input-label" data-i18n="cost">Buy Price</label>
            <input type="tel" id="add-price" placeholder="e.g 1.500.000" oninput="formatRupiahInput(this)">
            <label class="input-label" data-i18n="purchase_date">Purchase Date</label>
            <input type="date" id="add-date">
            <div style="display:flex; gap:10px; margin-top:20px">
                <button class="btn-primary" style="background:#333; color:#fff" onclick="toggleAddModal()" data-i18n="cancel">Cancel</button>
                <button class="btn-primary" onclick="saveInventory()" data-i18n="save">Save</button>
            </div>
        </div>
    </div>

	<div id="toast-container"></div>

	<div id="confirm-modal" onclick="closeConfirm()">
		<div class="confirm-box" onclick="event.stopPropagation()">
			<h3 id="confirm-title" style="margin-top:0" data-i18n="delete_portfolio">Delete portfolio</h3>
			<p id="confirm-msg" style="color:var(--text-sub); margin-bottom:25px"></p>
			<div style="display:flex; gap:12px">
				<button class="btn-primary" style="background:#333; color:#fff" onclick="closeConfirm()" data-i18n="cancel">Cancel</button>
				<button id="confirm-exec-btn" class="btn-primary" style="background:var(--danger); color:#fff" data-i18n="delete">Delete</button>
			</div>
		</div>
	</div>

    <div class="bottom-nav" id="mobile-nav"></div>

	<script src="./res/js/main.js"></script>
</body>
</html>