<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Harga Emas</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0b1220;
      color: #e5e7eb;
      padding: 20px;
    }

    h1 {
      margin-bottom: 5px;
    }

    p {
      color: #94a3b8;
      margin-bottom: 15px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: #020617;
    }

    th, td {
      border: 1px solid #334155;
      padding: 8px 10px;
    }

    th {
      background: #1e293b;
    }

    tr:nth-child(even) {
      background: #020617;
    }

    tr:hover {
      background: #1e293b;
    }

    .error {
      color: #f87171;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<h1>Harga Emas</h1>
<p>Source: Galeri24 & Sampoerna Gold</p>

<table>
  <thead>
    <tr>
      <th>Category</th>
      <th>Gram</th>
      <th>Jual</th>
      <th>Buyback</th>
    </tr>
  </thead>
  <tbody id="table-body">
    <tr>
      <td colspan="4">Loading...</td>
    </tr>
  </tbody>
</table>

<div id="error" class="error"></div>

<script>
/* =========================
   GALERI24 CONFIG
========================= */
const GALERI24_CATEGORY_MAP = {
  GALERI24: "GALERI 24",
  ANTAM: "ANTAM",
  ANTAM_RETRO: "ANTAM MULIA RETRO",
  ANTAM_NON_PEGADAIAN: "ANTAM NON PEGADAIAN",
  UBS: "UBS",
  LOTUS_ARCHI: "LOTUS ARCHI"
};

/* =========================
   LOAD GALERI24 (HTML)
========================= */
async function loadGaleri24() {
  const url =
    "https://api.allorigins.win/raw?url=https://galeri24.co.id/harga-emas";

  const response = await fetch(url);
  const html = await response.text(); // ✅ HTML, NOT JSON

  const doc = new DOMParser().parseFromString(html, "text/html");
  const result = [];

  for (const [category, domId] of Object.entries(GALERI24_CATEGORY_MAP)) {
    const container =
      doc.getElementById(domId)?.children?.[0]?.children?.[2];

    if (!container) continue;

    [...container.children].forEach(el => {
      const text = el.innerText.replace(/\s+/g, " ");

      const gram =
        text.match(/(\d+(?:[.,]\d+)?)\s*gram/i)?.[1];

      const prices =
        text.match(/Rp[\s\d.]+/g);

      if (!gram || !prices || prices.length < 2) return;

      result.push({
        category,
        gram: gram.replace(",", "."),
        jual: prices[0],
        buyback: prices[1]
      });
    });
  }

  return result;
}

/* =========================
   LOAD SAMPOERNA (JSON)
========================= */
async function loadSampoerna() {
  const url =
    "https://api.allorigins.win/raw?url=https://sampoernagold.com/";

  const response = await fetch(url);
  const data = await response.json(); // ✅ JSON

  return data.map(item => ({
    category: "SAMPOERNA",
    gram: item.gram,
    jual: item.jual,
    buyback: item.buyback
  }));
}

/* =========================
   RENDER TABLE
========================= */
function renderTable(data) {
  const tbody = document.getElementById("table-body");
  tbody.innerHTML = "";

  if (!data.length) {
    tbody.innerHTML =
      "<tr><td colspan='4'>No data</td></tr>";
    return;
  }

  data.forEach(item => {
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${item.category}</td>
      <td>${item.gram}</td>
      <td>${item.jual}</td>
      <td>${item.buyback}</td>
    `;

    tbody.appendChild(tr);
  });
}

/* =========================
   MAIN
========================= */
async function loadAll() {
  try {
    const [galeri24, sampoerna] = await Promise.all([
      loadGaleri24(),
      loadSampoerna()
    ]);

    renderTable([...sampoerna, ...galeri24]);
  } catch (err) {
    document.getElementById("error").textContent =
      "Failed to load data: " + err.message;
  }
}

loadAll();
</script>

</body>
</html>
