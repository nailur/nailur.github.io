<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Harga Emas (Galeri24 & Sampoerna)</title>
  <style>
    body {
      font-family: monospace;
      background: #f4f4f4;
      padding: 20px;
    }
    pre {
      background: #fff;
      padding: 15px;
      border-radius: 6px;
      overflow-x: auto;
    }
  </style>
</head>
<body>

<h1>Harga Emas</h1>

<h2>Galeri24</h2>
<pre id="galeri24">Loading...</pre>

<h2>Sampoerna Gold</h2>
<pre id="sampoerna">Loading...</pre>

<script>
  const CORS_PROXY = "https://api.allorigins.win/raw?url=";

  async function fetchHTML(url) {
    const res = await fetch(CORS_PROXY + encodeURIComponent(url));
    return res.text();
  }

  /* =========================
     GALERI24 PARSER (DIV BASED)
     ========================= */
  function parseGaleri24(doc) {
    const result = [];

    // Each gold item is inside a card-like container
    const items = doc.querySelectorAll("div");

    items.forEach(el => {
      const text = el.innerText || "";

      // Detect gram pattern
      const gramMatch = text.match(/(\d+(\.\d+)?)\s*Gram/i);
      const jualMatch = text.match(/Jual\s*Rp[\s.:]*([\d.,]+)/i);
      const buyMatch = text.match(/Buyback\s*Rp[\s.:]*([\d.,]+)/i);

      if (gramMatch && jualMatch) {
        result.push({
          gram: gramMatch[0],
          jual: "Rp " + jualMatch[1],
          buyback: buyMatch ? "Rp " + buyMatch[1] : null
        });
      }
    });

    // Remove duplicates
    return result.filter(
      (v, i, a) =>
        a.findIndex(t => t.gram === v.gram) === i
    );
  }

  /* =========================
     SAMPOERNA PARSER (TABLE)
     ========================= */
  function parseTable(doc) {
    const data = [];
    doc.querySelectorAll("table tr").forEach(row => {
      const cols = row.querySelectorAll("td");
      if (cols.length >= 3) {
        data.push({
          gram: cols[0].innerText.trim(),
          jual: cols[1].innerText.trim(),
          buyback: cols[2].innerText.trim()
        });
      }
    });
    return data;
  }

  async function loadGaleri24() {
    const html = await fetchHTML("https://galeri24.co.id/harga-emas");
    const doc = new DOMParser().parseFromString(html, "text/html");
    const data = parseGaleri24(doc);

    document.getElementById("galeri24").textContent =
      JSON.stringify(data, null, 2);
  }

  async function loadSampoerna() {
    const html = await fetchHTML("https://sampoernagold.com/");
    const doc = new DOMParser().parseFromString(html, "text/html");
    const data = parseTable(doc);

    document.getElementById("sampoerna").textContent =
      JSON.stringify(data, null, 2);
  }

  loadGaleri24();
  loadSampoerna();
</script>

</body>
</html>
