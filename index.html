<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Galeri24 Price API (Client Only)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 20px;
    }
    pre {
      background: #111;
      color: #0f0;
      padding: 15px;
      overflow: auto;
      max-height: 80vh;
    }
  </style>
</head>
<body>

<h1>Galeri24 JSON API (via AllOrigins)</h1>
<p id="status">Loadingâ€¦</p>
<pre id="output"></pre>

<script>
const GALERI24_URL =
  "https://api.allorigins.win/raw?url=" +
  encodeURIComponent("https://galeri24.co.id/harga-emas");

/* ===============================
   FETCH FULL GALERI24 HTML
================================ */

async function fetchGaleri24HTML() {
  const res = await fetch(GALERI24_URL);
  if (!res.ok) throw new Error("Failed to fetch Galeri24");
  return await res.text();
}

/* ===============================
   PARSE HTML INTO DOM
================================ */

function parseHTML(html) {
  return new DOMParser().parseFromString(html, "text/html");
}

/* ===============================
   CATEGORY RESOLVERS (YOUR PATHS)
================================ */

function getCategories(doc) {
  return {
    GALERY24:
      doc.getElementById("GALERI 24")?.children?.[0]?.children?.[2],

    ANTAM:
      doc.getElementById("ANTAM")?.children?.[0]?.children?.[2],

    ANTAM_RETRO:
      doc.getElementById("ANTAM MULIA RETRO")?.children?.[0]?.children?.[2],

    ANTAM_NON_PEGADAIAN:
      doc.getElementById("ANTAM NON PEGADAIAN")?.children?.[0]?.children?.[2],

    UBS:
      doc.getElementById("UBS")?.children?.[0]?.children?.[2],

    LOTUS_ARCHI:
      doc.getElementById("LOTUS ARCHI")?.children?.[0]?.children?.[2],
  };
}

/* ===============================
   EXTRACT ITEMS FROM CATEGORY
================================ */

function extractItems(container) {
  if (!container) return [];

  return [...container.children].map(el => {
    const text = el.innerText || "";

    return {
      name: el.querySelector("h3, h4")?.innerText?.trim() || "-",
      price: text.match(/Rp[\s\d.,]+/)?.[0] || "-",
      raw: text.trim()
    };
  });
}

/* ===============================
   BUILD JSON API RESPONSE
================================ */

function buildJSON(doc) {
  const categories = getCategories(doc);
  const result = {};

  for (const [key, container] of Object.entries(categories)) {
    result[key] = extractItems(container);
  }

  return result;
}

/* ===============================
   INIT
================================ */

(async function init() {
  try {
    const html = await fetchGaleri24HTML();
    const doc = parseHTML(html);
    const data = buildJSON(doc);

    document.getElementById("status").innerText = "Loaded successfully";
    document.getElementById("output").innerText =
      JSON.stringify(data, null, 2);

    // Optional: expose globally
    window.GALERI24_API = data;

  } catch (err) {
    document.getElementById("status").innerText = "Error";
    document.getElementById("output").innerText = err.message;
    console.error(err);
  }
})();
</script>

</body>
</html>
